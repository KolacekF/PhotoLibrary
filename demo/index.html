<!DOCTYPE html>
<html>
<head>
    <script>
        var my_global_variable_F = {}
    </script>
    <script>
        let None = null
        my_global_variable_F["JSON"] =
        [{'path': 'photos/DSC_0632.jpeg', 'creation': '2016:09:23 20:02:47', 'name': 'DSC_0632.jpeg', 'comment': None, 'gpslat': 49.0575, 'gpslon': 14.5213889}, {'path': 'photos/DSC_0976.jpeg', 'creation': '2017:03:15 21:09:44', 'name': 'DSC_0976.jpeg', 'comment': None, 'gpslat': 59.255, 'gpslon': 14.9702778}, {'path': 'photos/DSC_0595.jpeg', 'creation': '2016:05:03 13:35:25', 'name': 'DSC_0595.jpeg', 'comment': None, 'gpslat': 48.8566667, 'gpslon': 2.3508333}, {'path': 'photos/DSC_0594.jpeg', 'creation': '2016:05:03 13:35:16', 'name': 'DSC_0594.jpeg', 'comment': None, 'gpslat': 48.8566667, 'gpslon': 2.3508333}, {'path': 'photos/DSC_1281.jpeg', 'creation': '2016:06:21 14:47:31', 'name': 'DSC_1281.jpeg', 'comment': None, 'gpslat': 52.3669444, 'gpslon': 4.9025}, {'path': 'photos/DSC_1350.jpeg', 'creation': '2016:06:22 11:58:12', 'name': 'DSC_1350.jpeg', 'comment': None, 'gpslat': 50.1997222, 'gpslon': 9.2775}, {'path': 'photos/DSC_0977.jpeg', 'creation': '2017:03:15 21:11:01', 'name': 'DSC_0977.jpeg', 'comment': None, 'gpslat': 59.255, 'gpslon': 14.9702778}, {'path': 'photos/DSC_1316.jpeg', 'creation': '2016:06:22 10:39:50', 'name': 'DSC_1316.jpeg', 'comment': None, 'gpslat': 51.3086111, 'gpslon': 9.49}, {'path': 'photos/DSC_0591.jpeg', 'creation': '2016:05:03 13:16:27', 'name': 'DSC_0591.jpeg', 'comment': None, 'gpslat': 48.8566667, 'gpslon': 2.3508333}, {'path': 'photos/DSC_0660.jpeg', 'creation': '2017:05:23 23:39:41', 'name': 'DSC_0660.jpeg', 'comment': None, 'gpslat': 38.2472222, 'gpslon': 21.7547222}, {'path': 'photos/DSC_1349.jpeg', 'creation': '2016:06:22 11:58:11', 'name': 'DSC_1349.jpeg', 'comment': None, 'gpslat': 50.2, 'gpslon': 9.2775}, {'path': 'photos/DSC_0981.jpeg', 'creation': '2017:03:15 21:14:36', 'name': 'DSC_0981.jpeg', 'comment': None, 'gpslat': 59.255, 'gpslon': 14.9702778}, {'path': 'photos/DSC_1304.jpeg', 'creation': '2016:06:22 10:29:59', 'name': 'DSC_1304.jpeg', 'comment': None, 'gpslat': 59.4677778, 'gpslon': 24.3791667}, {'path': 'photos/DSC_1217.jpeg', 'creation': '2016:06:19 13:52:43', 'name': 'DSC_1217.jpeg', 'comment': None, 'gpslat': 41.3641667, 'gpslon': 2.1555556}, {'path': 'photos/DSC_0979.jpeg', 'creation': '2017:03:15 21:12:50', 'name': 'DSC_0979.jpeg', 'comment': None, 'gpslat': 59.2922222, 'gpslon': 14.8808333}, {'path': 'photos/DSC_0596.jpeg', 'creation': '2016:05:03 13:36:28', 'name': 'DSC_0596.jpeg', 'comment': None, 'gpslat': 48.8566667, 'gpslon': 2.3508333}, {'path': 'photos/DSC_1221.jpeg', 'creation': '2016:06:19 14:12:37', 'name': 'DSC_1221.jpeg', 'comment': None, 'gpslat': 41.3663889, 'gpslon': 2.1525}, {'path': 'photos/DSC_2567.jpeg', 'creation': '2018:09:16 02:16:51', 'name': 'DSC_2567.jpeg', 'comment': None, 'gpslat': 53.5505556, 'gpslon': 14.5658333}, {'path': 'photos/DSC_4450.jpeg', 'creation': '2018:10:20 17:44:59', 'name': 'DSC_4450.jpeg', 'comment': None, 'gpslat': 45.7672222, 'gpslon': 4.8338889}, {'path': 'photos/DSC_3395.jpeg', 'creation': '2017:07:07 17:08:51', 'name': 'DSC_3395.jpeg', 'comment': None, 'gpslat': 49.9688889, 'gpslon': 14.1330556}, {'path': 'photos/DSC_1111.jpeg', 'creation': '2018:10:20 17:25:40', 'name': 'DSC_1111.jpeg', 'comment': None, 'gpslat': 48.575, 'gpslon': 13.4683333}, {'path': 'photos/1111.jpeg', 'creation': '2018:01:29 14:04:44', 'name': '1111.jpeg', 'comment': None, 'gpslat': 46.9269444, 'gpslon': 17.8663889}, {'path': 'photos/DSC_2570.jpeg', 'creation': '2018:09:16 06:17:05', 'name': 'DSC_2570.jpeg', 'comment': None, 'gpslat': 55.9561111, 'gpslon': 10.0744444}, {'path': 'photos/DSC_0249.jpeg', 'creation': '2018:09:16 06:27:26', 'name': 'DSC_0249.jpeg', 'comment': None, 'gpslat': 49.0816667, 'gpslon': 13.29}, {'path': 'photos/DSC_4695.jpeg', 'creation': '2018:10:20 12:13:01', 'name': 'DSC_4695.jpeg', 'comment': None, 'gpslat': 49.9511111, 'gpslon': 19.3086111}, {'path': 'photos/DSC_1205.jpeg', 'creation': '2018:03:30 14:08:58', 'name': 'DSC_1205.jpeg', 'comment': None, 'gpslat': 45.5847222, 'gpslon': 9.1488889}, {'path': 'photos/DSC_5906.jpeg', 'creation': '2018:09:16 07:20:43', 'name': 'DSC_5906.jpeg', 'comment': None, 'gpslat': 49.0816667, 'gpslon': 13.29}, {'path': 'photos/DSC_2574.jpeg', 'creation': '2018:09:16 07:12:01', 'name': 'DSC_2574.jpeg', 'comment': None, 'gpslat': 48.9494444, 'gpslon': 13.6558333}, {'path': 'photos/DSC_4506.jpeg', 'creation': '2018:10:20 17:28:53', 'name': 'DSC_4506.jpeg', 'comment': None, 'gpslat': 48.575, 'gpslon': 13.4683333}, {'path': 'photos/DSC_43240.jpeg', 'creation': '2018:02:06 13:47:18', 'name': 'DSC_43240.jpeg', 'comment': None, 'gpslat': 48.7413889, 'gpslon': 18.7530556}, {'path': 'photos/DSC_2568.jpeg', 'creation': '2018:09:16 06:15:00', 'name': 'DSC_2568.jpeg', 'comment': None, 'gpslat': 50.7619444, 'gpslon': 15.7508333}, {'path': 'photos/DSC_2544.jpeg', 'creation': '2017:07:07 17:07:48', 'name': 'DSC_2544.jpeg', 'comment': None, 'gpslat': 49.9691667, 'gpslon': 14.0772222}, {'path': 'photos/SOS.jpeg', 'creation': '2018:10:20 12:37:25', 'name': 'SOS.jpeg', 'comment': None, 'gpslat': 47.8975, 'gpslon': 8.1188889}, {'path': 'photos/DSC_0324.jpeg', 'creation': '2018:09:16 02:08:17', 'name': 'DSC_0324.jpeg', 'comment': None, 'gpslat': 46.4822222, 'gpslon': 13.7788889}];
 my_global_variable_F['created'] = '2025-05-10';
    </script>
    
    <title>Photo Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.0/MarkerCluster.Default.min.css" />
    <style>
        body{
            /*display: flex;
            flex-direction: column;*/
            margin: 0;
            height: 100vh;
            overflow-y: hidden;
        }
        #map { height: 100vh; z-index: 1;}
        .popup_wrapper {
            width: 200px;
            overflow-y: scroll;
        }
        .popup_wrapper img{
            max-width: 200px;
            max-height: 200px;
        }
        .popup_wrapper div{
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .popup_wrapper p{
            display: inline-block;
        }
        .popup_wrapper div button{
            border-radius: 15px;
            border: none;
            background-color: rgb(228, 228, 228);
        }
        .popup_wrapper div button::before{
            content: "?";
        }
        .date_wrapper button:active::before, .date_wrapper button:hover::before{
            content: "datum pořízení";
        }
        .path_wrapper button:active::before, .path_wrapper button:hover::before{
            content: "umístění fotky";
        }

        #date_buttons_wrapper{
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-items: center;
            gap: 15px;
            position: relative;
            top: -72px;
            z-index: 100;
            overflow-x: scroll;
            margin: 0;
            padding: 16px 40px 16px 40px;
        }
        #date_buttons_wrapper li{
            list-style: none;
            border-radius: 5px;
            width: 180px;
            height: 40px;
            background-color: #2C2C2E;
            flex-shrink: 0;
        }
        #date_buttons_wrapper li :active{
            transform: translate(5px, 5px);
        }
        #date_buttons_wrapper input{
            display: none;
        }
        #date_buttons_wrapper label{
            cursor: pointer;
            color: #8E8E93;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            transition: all 0.5s ease;
        }
        #date_buttons_wrapper .date_buton_selected label{
            color: rgb(241, 241, 241);
            transition: all, ;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <ul id="date_buttons_wrapper"></ul>
    <script>
        function Popup(photo){
            let wrapper = document.createElement("div");
            let image = document.createElement("img");
            let date_str = document.createElement("p");
            let path_str = document.createElement("p");

            image.src = photo["path"];
            date_str.innerHTML = photo["creation"];
            path_str.innerHTML = photo["path"];

            let date_wrapper = document.createElement("div");
            let path_wrapper = document.createElement("div");

            date_wrapper.appendChild(date_str);
            date_wrapper.appendChild(document.createElement("button"));
            path_wrapper.appendChild(path_str);
            path_wrapper.appendChild(document.createElement("button"));

            wrapper.classList.add("popup_wrapper");
            date_wrapper.classList.add("date_wrapper");
            path_wrapper.classList.add("path_wrapper");

            wrapper.appendChild(image);
            wrapper.appendChild(date_wrapper);
            wrapper.appendChild(path_wrapper);

            return wrapper
        }
        my_global_variable_F["Popup"] = Popup;

        const Date_button_fn = (dates_list) => {
            let visible = false;
            let markers_local = [];
            function inner(e){
                e.target.parentNode.classList.toggle("date_buton_selected");

                if (visible){
                    markers_local.map((marker) => {
                        my_global_variable_F["markers"].removeLayer(marker);
                    })
                    markers_local.length = 0;

                    visible = !visible;
                } else{
                    dates_list.map((photo) => {
                        let marker = L.marker([photo["gpslat"], photo["gpslon"]]);
                        marker.bindPopup(my_global_variable_F["Popup"](photo));
                        /*markers.addLayer(marker);*/
                        my_global_variable_F["markers"].addLayer(marker);

                        markers_local.push(marker);
                        })
                    visible = !visible;
                }
            }
            return inner;
        }

        function Create_date_buttons(){
            let json = my_global_variable_F["JSON"];
            console.log(json);
            const dates = {
                "dates":new Set(),
                /*"set":(date, data) => {
                    if (this.date == null) {this.date = []}
                    console.log(this);
                    this.date.push(data);
                    this["dates"].add(date);
                }*/
                "dates_dict": {},
                set(date, data) {
                    if (this.date == null) {this.date = []}
                    this.date.push(data);
                    this["dates"].add(date);
                },
                set_new(date, data){
                    if (!(date in this.dates_dict)) {this.dates_dict[date] = []}
                    this.dates_dict[date].push(data);
                }

            }
            json.map((data) => {
                let date = data["creation"];
                if (date == null) {
                    dates.set("no date", data);
                    dates.set_new("no date", data);
                    return
                }
                let year = date.split(" ")[0].split(":")[0];
                dates.set(year, data);
                dates.set_new(year, data);
            })
            /*dates["dates"].forEach((string) => {
                let li = document.createElement("li");
                let input = document.createElement("input");
                let label = document.createElement("label");

                input.type = "checkbox";
                input.value = string;
                input.id = "date_button" + string;
                label.htmlFor = "date_button" + string;
                label.innerHTML = string;

                li.appendChild(input);
                li.appendChild(label);

                li.classList.add("date_buton_selected");
                input.oninput = (e) => {Date_button_fn(e, string)};
                
                document.getElementById("date_buttons_wrapper").appendChild(li);


                /*let button = document.createElement("button");
                button.innerHTML = string;
                document.getElementById("date_buttons_wrapper").appendChild(button);   /
            })*/
            for (const key in dates["dates_dict"]) {
                let li = document.createElement("li");
                let input = document.createElement("input");
                let label = document.createElement("label");

                input.type = "checkbox";
                input.value = key;
                input.id = "date_button" + key;
                label.htmlFor = "date_button" + key;
                label.innerHTML = key + " (" + dates["dates_dict"][key].length + ")";

                li.appendChild(input);
                li.appendChild(label);

                /*li.classList.add("date_buton_selected");*/

                let fn = Date_button_fn(dates["dates_dict"][key]);
                /*input.oninput = (e) => {fn(e)};*/
                input.addEventListener("input", function(e){fn(e)});
                
                
                /*input.oninput = (e) => {Date_button_fn(e, dates["dates_dict"].key)};*/
                
                document.getElementById("date_buttons_wrapper").appendChild(li);
            }

            my_global_variable_F["dates"] = dates;
        }

        Create_date_buttons();

    </script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
    <script>
        let map = L.map('map').setView([50.0755, 14.4378], 4);  // Starting position and zoom level

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        let markers = L.markerClusterGroup()
        my_global_variable_F["markers"] = markers

        let photos = [
            {"path": "photos/jester.jpg", "lat": 50.0755, "lon": 14.4378},
        ];

        /*photos.forEach(function(photo) {
            //var marker = L.marker([photo.lat, photo.lon]).addTo(map);
            let marker = L.marker([photo.lat, photo.lon]);
            //marker.bindPopup("<img src='" + photo.path + "' width='200' /><br />" + photo.path);
            marker.bindPopup(my_global_variable_F["Popup"](photo));

            markers.addLayer(marker);
        });*/

        /*my_global_variable_F["JSON"].forEach((photo) => {
            let marker = L.marker([photo["gpslat"], photo["gpslon"]]);
            marker.bindPopup(my_global_variable_F["Popup"](photo));

            /*markers.addLayer(marker);   /
            my_global_variable_F["markers"].addLayer(marker);
        })*/
        map.addLayer(my_global_variable_F["markers"]);


        let date_buttons_wrapper = document.getElementById("date_buttons_wrapper");
        for (const child of date_buttons_wrapper.children){
            for (const element of child.children){
                if (element.nodeName == "INPUT"){
                    console.log(element);
                    console.log(element.checked);
                    element.checked = true;
                    element.dispatchEvent(new Event('input', { bubbles: true }));
                    console.log(element.checked);
                }
            }
        }
    </script>
</body>
</html>
